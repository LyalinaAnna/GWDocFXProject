# Менеджер возврата действий (BackActionManager)

Данный компоннент служит для возврата действий пользователя тренажера при допущении им ошибки

![Alt text](/Images/BackActionManager1.png) 

### Основная задача компонента
При прохождении тренажера в режимах Тренировка и Экзамен пользователь может совершить какие либо ошибки. Неправильные действия пользователя вызовут меню ошибки с описание неправильных действий, а так же 3 кнопки которые предполагают дальнейшие действия пользователя в тренажере.

Выход - пользователь выходит из тренажера в главное меню выбора тренажеров.

Повторить - вызывает меню выбора режимов тренажеров в котором пользователь может выбрать другой режим и пройти заново текущий запущенный тренажер

Продолжить - пользователь возвращает негативные последствия от данной ошибки в исходное состояние и продолжает проходить тренажер.

Именно действие этой кнопки и реализует данный компонент.

## Как настроить
![Alt text](/Images/BackActionManager2.png) 

На сцене в объектах менеджеров, необходимо разместить пустой объект с компонентом "BackActionManager" наследуемым от типа MonoBehaviour. Он в свою очередь имеет одну публичную функцию вызов которой необходимо произвести при событии OnClick компонента Button на объекте "Continue" что соответствует клику по кнопке "Продолжить" в меню ошибки

![Alt text](/Images/BackActionManager3.png) 

При этом EventManager должен обрабатывать событие "Запись действия возврата"

![Alt text](/Images/BackActionManager4.png) 

### Зависимая логика других компонентов
Любой объект взаимодействия который подразумевает откат при неправильном с ним взаимодействии, должен позаботится о том что бы вернутся в исходное состояние. К примеру на скриншоте мы видим компонент который определяет своевременность нахождения пользователя в точке эвакуации, и если он находится там когда это является ошибкой, то компонент посылает событие через EventManager - "Запись действия возврата" и с ним делегат типа Action с записанными действиями которые произведут откат в надлежащее состояние в нашем случае это телепортирование игрока в начальную точку (_setCustomVRPosition.ResetPosition) и сброс переменной PlayerOnPoint

## Описание работы
![Alt text](/Images/BackActionManager5.png)

Компонент представляет собой класс, который, в момент своей работы слушает событие EventManager - "Запись действия возврата". Этого событие обрабатывается в методе AddingAnAction() которое получает уникальное действие возврата от компонента который вызвал это событие, и записывает его в делегат типа Action reverseActions. При срабатывании метода Return() который вызывается при событии OnClick кнопки "Продолжить"все действия записанные в делегате reverseActions выполняются, чем восстанавливают исходное состояние до момента совершения ошибки
